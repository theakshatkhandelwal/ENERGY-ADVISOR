{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
	<h3 class="mb-0">Recommendations</h3>
	<div class="d-flex align-items-center gap-2">
		<a href="{{ url_for('main.recommendations', rank='cost') }}" class="btn btn-sm {{ 'btn-primary' if rank!='co2' else 'btn-outline-primary' }}">Rank by ₹</a>
		<a href="{{ url_for('main.recommendations', rank='co2') }}" class="btn btn-sm {{ 'btn-primary' if rank=='co2' else 'btn-outline-primary' }}">Rank by CO₂</a>
		<form method="post" class="d-inline">
			<input type="hidden" name="name" value="Apply All ({{ '₹' if rank!='co2' else 'CO₂' }} ranked)">
			<button class="btn btn-sm btn-success">Apply all</button>
		</form>
	</div>
	</div>
<div class="row g-3">
	{% for r in recs %}
	{% set impact = 'High' if (r.delta_cost_month >= 200) else ('Medium' if (r.delta_cost_month >= 75) else 'Low') %}
	{% set payband = 'Fast' if (r.payback_months is not none and r.payback_months <= 6) else ('Moderate' if (r.payback_months is not none and r.payback_months <= 18) else ('None' if r.payback_months is none else 'Slow')) %}
	<div class="col-md-6">
		<div class="card h-100 shadow-sm border-0">
			<div class="card-body">
				<h5 class="card-title d-flex justify-content-between align-items-center">
					<span>{{ r.title }}</span>
					<span class="badge bg-success">₹ {{ r.delta_cost_month }}/mo</span>
				</h5>
				<div class="d-flex gap-2 mb-2">
					<span class="badge {{ 'bg-danger' if impact=='High' else ('bg-warning text-dark' if impact=='Medium' else 'bg-secondary') }}">Impact: {{ impact }}</span>
					<span class="badge {{ 'bg-success' if payband=='Fast' else ('bg-warning text-dark' if payband=='Moderate' else 'bg-secondary') }}">Payback: {{ payband }}</span>
				</div>
				<div class="row mt-2">
					<div class="col-6">
						<div class="mb-1"><span class="text-muted">ΔkWh/mo:</span> <strong>{{ r.delta_kwh_month }}</strong></div>
						<div class="mb-1"><span class="text-muted">ΔCO₂/mo (kg):</span> <strong>{{ r.delta_co2_month }}</strong></div>
					</div>
					<div class="col-6">
						<div class="mb-1"><span class="text-muted">Payback (mo):</span> <strong>{{ r.payback_months if r.payback_months is not none else '—' }}</strong></div>
						<button class="btn btn-link btn-sm p-0" data-bs-toggle="collapse" data-bs-target="#det-{{ loop.index }}">Details</button>
						<div id="det-{{ loop.index }}" class="collapse small">
							<div class="text-muted"><strong>Formula:</strong> {{ r.formula }}</div>
							<div class="text-break"><strong>Params:</strong> <code>{{ r.details }}</code></div>
						</div>
					</div>
				</div>
				<div class="mt-3">
					<a href="{{ url_for('main.scenarios') }}" class="btn btn-outline-primary btn-sm">Apply in Scenario</a>
				</div>
			</div>
		</div>
	</div>
	{% endfor %}
</div>
{% endblock %}


