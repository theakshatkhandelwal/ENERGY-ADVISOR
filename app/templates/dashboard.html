{% extends "base.html" %}
{% block content %}
<h3>Dashboard</h3>
<form method="post" class="row g-2 align-items-end mb-3">
	<div class="col-auto">
		<label class="form-label">Goal: kWh/month</label>
		<input name="goal_month_kwh" type="number" step="0.1" class="form-control" value="{{ goal_month_kwh }}">
	</div>
	<div class="col-auto">
		<label class="form-label">Goal: ₹/month</label>
		<input name="goal_month_cost" type="number" step="0.1" class="form-control" value="{{ goal_month_cost }}">
	</div>
	<div class="col-auto">
		<button class="btn btn-outline-primary">Save goals</button>
	</div>
</form>
<div class="row g-3 mb-4">
	<div class="col-md-3">
		<div class="card"><div class="card-body">
			<div class="fw-bold">kWh/day</div>
			<div class="display-6">{{ kpis.daily_kwh }}</div>
		</div></div>
	</div>
	<div class="col-md-3">
		<div class="card"><div class="card-body">
			<div class="fw-bold">kWh/month</div>
			<div class="display-6">{{ kpis.monthly_kwh }}</div>
		</div></div>
	</div>
	<div class="col-md-3">
		<div class="card"><div class="card-body">
			<div class="fw-bold">₹/month</div>
			<div class="display-6">{{ kpis.monthly_cost }}</div>
		</div></div>
	</div>
	<div class="col-md-3">
		<div class="card"><div class="card-body">
			<div class="fw-bold">CO₂ kg/month</div>
			<div class="display-6">{{ kpis.monthly_co2 }}</div>
		</div></div>
	</div>
</div>
{% if goal_month_kwh or goal_month_cost %}
<div class="row g-3 mb-4">
	<div class="col-md-6">
		<div class="card"><div class="card-body">
			<div class="fw-bold mb-2">Progress to kWh goal</div>
			<div class="progress">
				<div class="progress-bar" role="progressbar" style="width: {{ progress_kwh }}%;" aria-valuenow="{{ progress_kwh }}" aria-valuemin="0" aria-valuemax="100">{{ progress_kwh }}%</div>
			</div>
		</div></div>
	</div>
	<div class="col-md-6">
		<div class="card"><div class="card-body">
			<div class="fw-bold mb-2">Progress to ₹ goal</div>
			<div class="progress">
				<div class="progress-bar bg-success" role="progressbar" style="width: {{ progress_cost }}%;" aria-valuenow="{{ progress_cost }}" aria-valuemin="0" aria-valuemax="100">{{ progress_cost }}%</div>
			</div>
		</div></div>
	</div>
</div>
{% endif %}
<div class="row">
	<div class="col-md-6 mb-4">
		<canvas id="pieChart"></canvas>
		<div class="small text-muted mt-2">
			Formula: E_daily = Σ(P × N × T) / 1000
		</div>
	</div>
	<div class="col-md-6 mb-4">
		<canvas id="topHogs"></canvas>
		<div class="small text-muted mt-2">
			Top 5 energy hogs (kWh/day)
		</div>
	</div>
</div>
<script>
const pieCtx = document.getElementById('pieChart');
const pieChart = new Chart(pieCtx, {
	type: 'pie',
	data: {
		labels: {{ pie_labels|safe }},
		datasets: [{ data: {{ pie_values|safe }}, backgroundColor: ['#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f','#edc948','#b07aa1','#ff9da7','#9c755f','#bab0ab'] }]
	}
});
const barCtx = document.getElementById('topHogs');
new Chart(barCtx, {
	type: 'bar',
	data: {
		labels: {{ top_labels|safe }},
		datasets: [{ data: {{ top_values|safe }}, backgroundColor: ['#e15759','#f28e2b','#4e79a7','#59a14f','#b07aa1'] }]
	},
	options: {
		indexAxis: 'y',
		plugins: { legend: { display: false }, tooltip: { callbacks: { label: (ctx) => ctx.parsed.x + ' kWh/day' } } },
		scales: { x: { beginAtZero: true, grid: { display: false } }, y: { grid: { display: false } } }
	}
});
</script>
{% endblock %}


